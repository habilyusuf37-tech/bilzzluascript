-- PremiumHub All-in-One Script
if not game:IsLoaded() then
    game.Loaded:Wait()
end

-- Rayfield loader
local function loadRayfield()
    local urls = {
        "https://raw.githubusercontent.com/UI-Library/Rayfield/main/source.lua",
        "https://raw.githubusercontent.com/shlexware/Rayfield/main/source.lua",
        "https://raw.githubusercontent.com/SiriusSoftwareLtd/Rayfield/main/source.lua"
    }
    for _, link in ipairs(urls) do
        local ok, lib = pcall(function()
            return loadstring(game:HttpGet(link, true))()
        end)
        if ok and lib then
            return lib
        end
    end
    return nil
end

local Rayfield = loadRayfield()
if not Rayfield then
    warn("PremiumHub: Rayfield failed to load.")
    return
end

-- Remotes & services
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

local TeleportDealerEvent = ReplicatedStorage:WaitForChild("TeleportDealerEvent")
local OpenDealerEvent      = ReplicatedStorage:WaitForChild("OpenDealerEvent")
local OpenDealerClient     = ReplicatedStorage:WaitForChild("OpenDealerClient")
local GetDealerItems       = ReplicatedStorage:WaitForChild("GetDealerItems")
local BuyCarEvent          = ReplicatedStorage:WaitForChild("BuyCarEvent")
local ClaimBoxEvent        = ReplicatedStorage:WaitForChild("ClaimBoxEvent")
local NotifyEvent          = ReplicatedStorage:WaitForChild("NotifyEvent")

-- Dealer teleport coords
local DealerTP = {
    Vector3.new(351.16, 8.19, -286.64),
    Vector3.new(940.53, 6.29, -474.83),
    Vector3.new(2470.92, 5.11, -550.10),
    Vector3.new(3083.91, 5.55, -546.16),
}

-- Create DealerUI if missing
local function ensureDealerUI()
    local gui = LocalPlayer:FindFirstChild("PlayerGui"):WaitForChild("DealerUI", 1)
    if gui then return gui end

    local screen = Instance.new("ScreenGui", LocalPlayer.PlayerGui)
    screen.Name = "DealerUI"
    screen.ResetOnSpawn = false

    local frame = Instance.new("Frame", screen)
    frame.Name = "MainFrame"
    frame.AnchorPoint = Vector2.new(0.5,0.5)
    frame.Position = UDim2.new(0.5,0.5,0,0)
    frame.Size = UDim2.new(0,720,0,420)
    frame.BackgroundTransparency = 0.2

    local title = Instance.new("TextLabel", frame)
    title.Name = "Title"
    title.Size = UDim2.new(1,0,0,40)
    title.Position = UDim2.new(0,0,0,0)
    title.BackgroundTransparency = 1
    title.Font = Enum.Font.SourceSansBold
    title.TextSize = 22
    title.Text = "Dealer"

    local list = Instance.new("ScrollingFrame", frame)
    list.Name = "List"
    list.Size = UDim2.new(1,-20,1,-60)
    list.Position = UDim2.new(0,10,0,45)
    list.CanvasSize = UDim2.new(0,0,1,0)
    list.AutomaticCanvasSize = Enum.AutomaticSize.Y
    list.ScrollBarThickness = 8

    local template = Instance.new("Frame", list)
    template.Name = "TemplateItem"
    template.Size = UDim2.new(1,-10,0,80)
    template.BackgroundTransparency = 0.2
    template.Visible = false

    local nameLbl = Instance.new("TextLabel", template)
    nameLbl.Name = "CarName"
    nameLbl.Size = UDim2.new(0.6,0,1,0)
    nameLbl.Position = UDim2.new(0,8,0,0)
    nameLbl.BackgroundTransparency = 1
    nameLbl.Font = Enum.Font.SourceSansBold
    nameLbl.TextSize = 18
    nameLbl.Text = "Car"

    local priceLbl = Instance.new("TextLabel", template)
    priceLbl.Name = "Price"
    priceLbl.Size = UDim2.new(0.25,0,1,0)
    priceLbl.Position = UDim2.new(0.62,0,0,0)
    priceLbl.BackgroundTransparency = 1
    priceLbl.Font = Enum.Font.SourceSans
    priceLbl.TextSize = 16
    priceLbl.Text = "$0"

    local buyBtn = Instance.new("TextButton", template)
    buyBtn.Name = "BuyButton"
    buyBtn.Size = UDim2.new(0.12,-10,0.8,-10)
    buyBtn.Position = UDim2.new(0.86,0,0.1,0)
    buyBtn.Text = "Buy"

    return screen
end

-- Notification handler
NotifyEvent.OnClientEvent:Connect(function(typeStr, message)
    if Rayfield.Notify then
        Rayfield:Notify({Title = typeStr, Content = message, Duration = 4})
    else
        warn(typeStr, message)
    end
end)

-- Handle open dealer UI
OpenDealerClient.OnClientEvent:Connect(function(dealerName)
    local gui = ensureDealerUI()
    gui.Enabled = true
    local frame = gui.MainFrame
    frame.Title.Text = dealerName .. " Dealer"

    local ok, items = pcall(function()
        return GetDealerItems:InvokeServer(dealerName)
    end)
    if not ok or type(items) ~= "table" then
        NotifyEvent:FireClient(LocalPlayer, "Error", "Failed to load items.")
        return
    end

    local list = frame.List
    for _,child in ipairs(list:GetChildren()) do
        if child:IsA("Frame") and child.Name ~= "TemplateItem" then
            child:Destroy()
        end
    end

    local template = list:FindFirstChild("TemplateItem")
    for i,car in ipairs(items) do
        local clone = template:Clone()
        clone.Name = "Item_" .. tostring(i)
        clone.Visible = true

        local nameLbl = clone:FindFirstChild("CarName")
        if nameLbl then nameLbl.Text = car.Name end
        local priceLbl = clone:FindFirstChild("Price")
        if priceLbl then priceLbl.Text = "$" .. tostring(car.Price) end

        local btn = clone:FindFirstChild("BuyButton")
        if btn then
            btn.MouseButton1Click:Connect(function()
                BuyCarEvent:FireServer(dealerName, car.Id)
            end)
        end

        clone.Parent = list
    end
end)

-- KeySystem & UI build
Rayfield:CreateKeySystem({
    Title = "Premium Hub Key",
    Subtitle = "Enter your key",
    Note = "Key: premiumhub",
    SaveKey = true,
    Key = "premiumhub",
    Callback = function(passed)
        local Window = Rayfield:CreateWindow({
            Name = "Premium Hub Menu",
            LoadingTitle = "Premium Hub",
            LoadingSubtitle = "By Bill",
            Theme = "Dark",
            ConfigurationSaving = {Enabled = true, FolderName = "PremiumHubConfig", FileName = "Config1"}
        })

        local SelectedDealerBrand = "Premium"
        local TeleIndex = 1
        local AutoFarm = false

        -- MAIN
        local MainTab = Window:CreateTab("Main")
        MainTab:CreateInput({Name="Webhook", PlaceholderText="Enter webhook", Callback=function(t) webhook = t end})
        MainTab:CreateToggle({Name="AutoFarm", CurrentValue=false, Callback=function(v) AutoFarm=v Rayfield:Notify({Title="AutoFarm", Content=(v and "Enabled" or "Disabled")}) end})
        MainTab:CreateButton({Name="Exit Farm", Callback=function() AutoFarm=false Rayfield:Notify({Title="AutoFarm", Content="Stopped"}) end})

        -- STATS
        local StatsTab = Window:CreateTab("Stats")
        StatsTab:CreateLabel("Teleport Cooldown: 0s")
        StatsTab:CreateLabel("Elapsed Time: 0s")
        StatsTab:CreateLabel("Status Earning: Idle")
        StatsTab:CreateLabel("Total Money: $0")
        StatsTab:CreateLabel("Total Earning: $0")
        StatsTab:CreateLabel("Money Received: $0")

        -- CONFIGURATION
        local ConfigTab = Window:CreateTab("Configuration")
        ConfigTab:CreateSlider({Name="Set Teleport Time", Range={1,10}, Increment=1, CurrentValue=3, Callback=function(v) tpTime=v end})
        ConfigTab:CreateInput({Name="Set Recall Job", PlaceholderText="Job Name", Callback=function(t) recalljob=t end})

        -- BOX
        local BoxTab = Window:CreateTab("Box")
        BoxTab:CreateButton({Name="Claim Daily Box", Callback=function() ClaimBoxEvent:FireServer("Daily") end})
        BoxTab:CreateButton({Name="Buy Limited Box", Callback=function() ClaimBoxEvent:FireServer("Limited") end})
        BoxTab:CreateButton({Name="Buy Gamepass Box", Callback=function() ClaimBoxEvent:FireServer("Gamepass") end})

        -- DEALERSHIP
        local DealerTab = Window:CreateTab("Dealership")
        DealerTab:CreateDropdown({Name="Select Dealership", Options={"Premium","SLM","Toyota","BMR","Nissan","Retro","Mizada","Hyundai"}, CurrentOption="Premium", Callback=function(v) SelectedDealerBrand=v end})
        DealerTab:CreateDropdown({Name="Teleport Dealer", Options={"Dealer 1","Dealer 2","Dealer 3","Dealer 4"}, CurrentOption="Dealer 1", Callback=function(opt) TeleIndex = tonumber(opt:match("%d+")) or 1 end})
        DealerTab:CreateButton({Name="TP Dealer", Callback=function() TeleportDealerEvent:FireServer(TeleIndex) end})
        DealerTab:CreateButton({Name="Open Dealer Anywhere", Callback=function() OpenDealerEvent:FireServer(SelectedDealerBrand) end})
        DealerTab:CreateButton({Name="Buy Car", Callback=function() BuyCarEvent:FireServer(SelectedDealerBrand) end})
    end
})
