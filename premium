-- Premium Hub (Kavo Version - Key: premiumhub)
if not game:IsLoaded() then game.Loaded:Wait() end

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local LocalPlayer = Players.LocalPlayer
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")

-- Kavo Library (link hidup 100% November 2025)
local Library = loadstring(game:HttpGet("https://raw.githubusercontent.com/xHeptc/Kavo-UI-Library/main/source.lua"))()
local Window = Library.CreateLib("PremiumHub", "DarkTheme")

local function getRemote(name,class,timeout)
    local ok,obj=pcall(function()return ReplicatedStorage:WaitForChild(name,timeout or 5)end)
    return (ok and obj and obj.ClassName==class) and obj or nil
end

local TeleportDealerEvent = getRemote("TeleportDealerEvent","RemoteEvent")
local OpenDealerEvent     = getRemote("OpenDealerEvent","RemoteEvent")
local OpenDealerClient    = getRemote("OpenDealerClient","RemoteEvent")
local GetDealerItems      = getRemote("GetDealerItems","RemoteFunction")
local BuyCarEvent         = getRemote("BuyCarEvent","RemoteEvent")
local ClaimBoxEvent       = getRemote("ClaimBoxEvent","RemoteEvent")
local NotifyEvent         = getRemote("NotifyEvent","RemoteEvent")

local function safeFire(r,...) if r then pcall(function() r:FireServer(...) end) end end
local function safeInvoke(r,...) if r then local s,v=pcall(r.InvokeServer,r,...) return s and v end end

local DealerTP = {
    Vector3.new(351.16,8.19,-286.64),
    Vector3.new(940.53,6.29,-474.83),
    Vector3.new(2470.92,5.11,-550.10),
    Vector3.new(3083.91,5.55,-546.16),
}

-- Dealer UI (tetap sama)
local function dealerUI()
    local s=Instance.new("ScreenGui",PlayerGui) s.Name="DealerUI" s.ResetOnSpawn=false
    local f=Instance.new("Frame",s) f.Name="MainFrame" f.AnchorPoint=Vector2.new(.5,.5) f.Position=UDim2.new(.5,0,.5,0)
    f.Size=UDim2.new(0,720,0,420) f.BackgroundTransparency=.15 f.BackgroundColor3=Color3.fromRGB(30,30,30)

    local t=Instance.new("TextLabel",f) t.Name="Title" t.Size=UDim2.new(1,0,0,40)
    t.BackgroundTransparency=1 t.Font=Enum.Font.SourceSansBold t.TextSize=22 t.TextColor3=Color3.new(1,1,1) t.Text="Dealer"

    local list=Instance.new("ScrollingFrame",f) list.Name="List"
    list.Size=UDim2.new(1,-20,1,-60) list.Position=UDim2.new(0,10,0,45)
    list.AutomaticCanvasSize=Enum.AutomaticSize.Y list.ScrollBarThickness=8

    local template=Instance.new("Frame",list) template.Name="TemplateItem"
    template.Size=UDim2.new(1,-10,0,80) template.Visible=false template.BackgroundTransparency=.25

    Instance.new("TextLabel",template).Name="CarName"
    Instance.new("TextLabel",template).Name="Price"
    local b=Instance.new("TextButton",template) b.Name="BuyButton" b.Size=UDim2.new(.12,-10,.8,-10) b.Position=UDim2.new(.86,0,.1,0) b.Text="Buy"
    return s
end

local GUI

-- Notify dari server (pake Kavo notification)
if NotifyEvent then
    NotifyEvent.OnClientEvent:Connect(function(t,m)
        Library:Notify("PremiumHub", tostring(t) .. ": " .. tostring(m), 4)
    end)
end

-- Dealer UI dari server
if OpenDealerClient then
    OpenDealerClient.OnClientEvent:Connect(function(name)
        GUI = GUI or dealerUI()
        GUI.Enabled=true
        local frame = GUI.MainFrame
        frame.Title.Text = name.." Dealer"

        for _,v in ipairs(frame.List:GetChildren()) do if v:IsA("Frame") and v.Name~="TemplateItem" then v:Destroy() end end
        local items = safeInvoke(GetDealerItems,name)
        local temp = frame.List.TemplateItem

        for i,v in ipairs(items or {}) do
            local c=temp:Clone() c.Visible=true c.Name="Item"..i c.Parent=frame.List
            c.CarName.Text=v.Name c.Price.Text="$"..v.Price
            c.BuyButton.MouseButton1Click:Connect(function() safeFire(BuyCarEvent,name,v.Id) end)
        end
    end)
end

-- ==== KEY SYSTEM KAVO (key: premiumhub) ====
local KeyInput = Library:CreateWindow({
    Title = "Premium Hub Key",
    Size = UDim2.new(0, 300, 0, 150),
    Position = UDim2.new(0.5, -150, 0.5, -75)
}).CreateTextbox({
    Name = "Masukkan Key",
    Default = "",
    Placeholder = "Key: premiumhub",
    Size = UDim2.new(1, 0, 0, 30),
    Position = UDim2.new(0, 0, 0, 50)
})

KeyInput.OnChanged(function(text)
    if text == "premiumhub" then
        Library:Notify("Success!", "Key valid! Premium Hub Loaded", 6)
        KeyInput:Destroy()
        
        -- UI SESUDAH KEY VALID
        local dealer,tele,af,tpTime = "Premium",1,false,3
        local webhook = ""

        local MainTab = Window:NewTab("Main")
        local MainSection = MainTab:NewSection("Main Features")
        MainSection:NewTextBox("Webhook", "Enter webhook URL", function(t) webhook = t end)
        MainSection:NewToggle("AutoFarm", "Enable/Disable AutoFarm", function(state) af = state end)
        MainSection:NewButton("Stop Farm", "Stop AutoFarm", function() af = false end)

        local StatsTab = Window:NewTab("Stats")
        local StatsSection = StatsTab:NewSection("Player Stats")
        StatsSection:NewLabel("Status: Idle")
        StatsSection:NewLabel("Money: $0")

        local ConfigTab = Window:NewTab("Config")
        local ConfigSection = ConfigTab:NewSection("Settings")
        ConfigSection:NewSlider("TP Time", "Teleport delay (seconds)", 1, 30, function(s) tpTime = s end)

        local BoxTab = Window:NewTab("Box")
        local BoxSection = BoxTab:NewSection("Claim Boxes")
        BoxSection:NewButton("Daily Box", "Claim Daily", function() safeFire(ClaimBoxEvent,"Daily") end)
        BoxSection:NewButton("Limited Box", "Claim Limited", function() safeFire(ClaimBoxEvent,"Limited") end)
        BoxSection:NewButton("Gamepass Box", "Claim Gamepass", function() safeFire(ClaimBoxEvent,"Gamepass") end)

        local DealerTab = Window:NewTab("Dealership")
        local DealerSection = DealerTab:NewSection("Dealer Tools")
        DealerSection:NewDropdown("Brand", "Select Brand", {"Premium","SLM","Toyota","BMR","Nissan","Retro","Mizada","Hyundai"}, function(v) dealer = v end)
        DealerSection:NewDropdown("Dealer", "Select Dealer", {"Dealer 1","Dealer 2","Dealer 3","Dealer 4"}, function(v) tele = tonumber(v:match("%d+")) end)
        DealerSection:NewButton("TP Dealer", "Teleport to Dealer", function()
            if TeleportDealerEvent then 
                safeFire(TeleportDealerEvent,tele)
            else
                local c = LocalPlayer.Character
                if c and c:FindFirstChild("HumanoidRootPart") then
                    c:PivotTo(CFrame.new(DealerTP[tele]))
                end
            end
        end)
        DealerSection:NewButton("Open Dealer", "Open Dealer Menu", function() safeFire(OpenDealerEvent,dealer) end)
        DealerSection:NewButton("Buy Car (UI)", "Buy via Dealer UI", function()
            Library:Notify("Info", "Buka dealer dulu lalu klik tombol Buy di UI dealer", 6)
        end)
    else
        if text ~= "" and text ~= "premiumhub" then
            Library:Notify("Error", "Key salah! Coba lagi: premiumhub", 4)
        end
    end
end)
