-- Premium Hub (compressed build)
if not game:IsLoaded() then game.Loaded:Wait() end

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local LocalPlayer = Players.LocalPlayer
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")

-- Rayfield loader
local function loadRayfield()
    for _,link in next,{
        "https://raw.githubusercontent.com/shlexware/Rayfield/main/source.lua",
        "https://raw.githubusercontent.com/SiriusSoftwareLtd/Rayfield/main/source.lua",
        "https://raw.githubusercontent.com/UI-Library/Rayfield/main/source.lua"
    } do
        local ok,lib=pcall(function()return loadstring(game:HttpGet(link,true))()end)
        if ok and lib then return lib end
    end
end

local Rayfield = loadRayfield()
if not Rayfield then warn("Rayfield failed") return end

local function getRemote(name,class,timeout)
    local ok,obj=pcall(function()return ReplicatedStorage:WaitForChild(name,timeout or 5)end)
    return (ok and obj and obj.ClassName==class) and obj or nil
end

local TeleportDealerEvent = getRemote("TeleportDealerEvent","RemoteEvent")
local OpenDealerEvent     = getRemote("OpenDealerEvent","RemoteEvent")
local OpenDealerClient    = getRemote("OpenDealerClient","RemoteEvent")
local GetDealerItems      = getRemote("GetDealerItems","RemoteFunction")
local BuyCarEvent         = getRemote("BuyCarEvent","RemoteEvent")
local ClaimBoxEvent       = getRemote("ClaimBoxEvent","RemoteEvent")
local NotifyEvent         = getRemote("NotifyEvent","RemoteEvent")

local function safeFire(r,...) if r then pcall(function() r:FireServer(...) end) end end
local function safeInvoke(r,...) return r and (pcall(function()return r:InvokeServer(...) end)) or nil end

local DealerTP = {
    Vector3.new(351.16,8.19,-286.64),
    Vector3.new(940.53,6.29,-474.83),
    Vector3.new(2470.92,5.11,-550.10),
    Vector3.new(3083.91,5.55,-546.16),
}

-- dealer UI minimal builder
local function dealerUI()
    local s=Instance.new("ScreenGui",PlayerGui) s.Name="DealerUI" s.ResetOnSpawn=false
    local f=Instance.new("Frame",s) f.Name="MainFrame" f.AnchorPoint=Vector2.new(.5,.5) f.Position=UDim2.new(.5,.5,0,0)
    f.Size=UDim2.new(0,720,0,420) f.BackgroundTransparency=.15 f.BackgroundColor3=Color3.fromRGB(30,30,30)

    local t=Instance.new("TextLabel",f) t.Name="Title" t.Size=UDim2.new(1,0,0,40)
    t.BackgroundTransparency=1 t.Font=Enum.Font.SourceSansBold t.TextSize=22 t.TextColor3=Color3.new(1,1,1) t.Text="Dealer"

    local list=Instance.new("ScrollingFrame",f) list.Name="List"
    list.Size=UDim2.new(1,-20,1,-60) list.Position=UDim2.new(0,10,0,45)
    list.AutomaticCanvasSize=Enum.AutomaticSize.Y list.ScrollBarThickness=8

    local template=Instance.new("Frame",list) template.Name="TemplateItem"
    template.Size=UDim2.new(1,-10,0,80) template.Visible=false template.BackgroundTransparency=.25

    Instance.new("TextLabel",template).Name="CarName"
    Instance.new("TextLabel",template).Name="Price"
    local b=Instance.new("TextButton",template) b.Name="BuyButton" b.Size=UDim2.new(.12,-10,.8,-10) b.Position=UDim2.new(.86,0,.1,0) b.Text="Buy"
    return s
end

local GUI

if NotifyEvent then
    NotifyEvent.OnClientEvent:Connect(function(t,m)
        Rayfield:Notify({Title=tostring(t),Content=tostring(m),Duration=4})
    end)
end

if OpenDealerClient then
    OpenDealerClient.OnClientEvent:Connect(function(name)
        GUI = GUI or dealerUI()
        GUI.Enabled=true
        local frame = GUI.MainFrame
        frame.Title.Text = name.." Dealer"

        for _,v in ipairs(frame.List:GetChildren()) do if v:IsA("Frame") and v.Name~="TemplateItem" then v:Destroy() end end
        local items = safeInvoke(GetDealerItems,name)
        local temp = frame.List.TemplateItem

        for i,v in ipairs(items or {}) do
            local c=temp:Clone() c.Visible=true c.Name="Item"..i c.Parent=frame.List
            c.CarName.Text=v.Name c.Price.Text="$"..v.Price
            c.BuyButton.MouseButton1Click:Connect(function() safeFire(BuyCarEvent,name,v.Id) end)
        end
    end)
end

-- ================= UI ===================
Rayfield:CreateKeySystem({
    Title="Premium Hub Key",Note="Key: premiumhub",SaveKey=true,Key="premiumhub",
    Callback=function()
        local Window = Rayfield:CreateWindow({Name="PremiumHub",LoadingTitle="PremiumHub",Theme="Dark"})
        local dealer,tele,af,tpTime="Premium",1,false,3

        local Main = Window:CreateTab("Main")
        Main:CreateInput({Name="Webhook",Callback=function(t)webhook=t end})
        Main:CreateToggle({Name="AutoFarm",CurrentValue=false,Callback=function(v)af=v end})
        Main:CreateButton({Name="Stop Farm",Callback=function()af=false end})

        local Stats = Window:CreateTab("Stats")
        Stats:CreateLabel("Status: Idle"); Stats:CreateLabel("Money: $0")

        local Config = Window:CreateTab("Config")
        Config:CreateSlider({Name="TP Time",Range={1,30},CurrentValue=3,Callback=function(v)tpTime=v end})

        local Box = Window:CreateTab("Box")
        Box:CreateButton({Name="Daily Box",Callback=function()safeFire(ClaimBoxEvent,"Daily")end})
        Box:CreateButton({Name="Limited Box",Callback=function()safeFire(ClaimBoxEvent,"Limited")end})
        Box:CreateButton({Name="Gamepass Box",Callback=function()safeFire(ClaimBoxEvent,"Gamepass")end})

        local D = Window:CreateTab("Dealership")
        D:CreateDropdown({Name="Brand",Options={"Premium","SLM","Toyota","BMR","Nissan","Retro","Mizada","Hyundai"},Callback=function(v)dealer=v end})
        D:CreateDropdown({Name="Dealer",Options={"Dealer 1","Dealer 2","Dealer 3","Dealer 4"},Callback=function(v)tele=tonumber(v:match("%d+"))end})
        D:CreateButton({Name="TP Dealer",Callback=function()
            if TeleportDealerEvent then safeFire(TeleportDealerEvent,tele)
            else
                local c=LocalPlayer.Character;if c then c:PivotTo(CFrame.new(DealerTP[tele]))end
            end
        end})
        D:CreateButton({Name="Open Dealer",Callback=function()safeFire(OpenDealerEvent,dealer)end})
        D:CreateButton({Name="Buy Car (UI)",Callback=function()Rayfield:Notify({Title="Info",Content="Open a dealer and click buy"})end})
    end
})
