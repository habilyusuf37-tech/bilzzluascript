-- MIYOSHI PREMIUM - BULATAN B KIRI ATAS + MENU 100% KELUAR (FINAL FIX)

local CorrectKey = "MIYOSHI2025"
local Players = game:GetService("Players")
local CoreGui = game:GetService("CoreGui")
local TweenService = game:GetService("TweenService")
local LocalPlayer = Players.LocalPlayer

-- REDEEM KEY
local RedeemGui = Instance.new("ScreenGui", CoreGui)
RedeemGui.ResetOnSpawn = false

local Back = Instance.new("Frame", RedeemGui)
Back.Size = UDim2.new(0,380,0,220)
Back.Position = UDim2.new(0.5,-190,0.5,-110)
Back.BackgroundColor3 = Color3.fromRGB(12,12,12)
Instance.new("UICorner", Back).CornerRadius = UDim.new(0,16)

local Title = Instance.new("TextLabel", Back)
Title.Size = UDim2.new(1,0,0,50)
Title.BackgroundTransparency = 1
Title.Text = "PREMIUM BY MIYOSHI"
Title.TextColor3 = Color3.fromRGB(255,50,150)
Title.Font = Enum.Font.GothamBlack
Title.TextSize = 28

local TB = Instance.new("TextBox", Back)
TB.Size = UDim2.new(0.85,0,0,45)
TB.Position = UDim2.new(0.075,0,0,70)
TB.PlaceholderText = "Enter Key..."
TB.BackgroundColor3 = Color3.fromRGB(40,40,40)
Instance.new("UICorner", TB).CornerRadius = UDim.new(0,10)

local RedeemBtn = Instance.new("TextButton", Back)
RedeemBtn.Size = UDim2.new(0.85,0,0,48)
RedeemBtn.Position = UDim2.new(0.075,0,0,130)
RedeemBtn.BackgroundColor3 = Color3.fromRGB(255,50,150)
RedeemBtn.Text = "REDEEM"
RedeemBtn.TextColor3 = Color3.new(1,1,1)
Instance.new("UICorner", RedeemBtn).CornerRadius = UDim.new(0,10)

RedeemBtn.MouseButton1Click:Connect(function()
    if TB.Text ~= CorrectKey then
        TB.PlaceholderText = "Key Salah!"
        TB.Text = ""
        return
    end

    RedeemGui:Destroy()

    -- SATU GUI SAJA + ZINDEX TINGGI = TIDAK BUG LAGI
    local GUI = Instance.new("ScreenGui")
    GUI.Parent = CoreGui
    GUI.ResetOnSpawn = false
    GUI.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

    -- BULATAN B DI KIRI ATAS
    local BBtn = Instance.new("TextButton", GUI)
    BBtn.Size = UDim2.new(0,70,0,70)
    BBtn.Position = UDim2.new(0,15,0,15)   -- pojok kiri atas
    BBtn.BackgroundColor3 = Color3.new(1,1,1)
    BBtn.Text = "B"
    BBtn.TextColor3 = Color3.new(0,0,0)
    BBtn.Font = Enum.Font.GothamBlack
    BBtn.TextSize = 50
    BBtn.TextScaled = true
    BBtn.ZIndex = 9999
    Instance.new("UICorner", BBtn).CornerRadius = UDim.new(1,0)

    local Glow = Instance.new("UIStroke", BBtn)
    Glow.Color = Color3.fromRGB(255,50,150)
    Glow.Thickness = 6

    -- MENU MINI PREMIUM
    local Menu = Instance.new("Frame", GUI)
    Menu.Size = UDim2.new(0,300,0,460)
    Menu.Position = UDim2.new(0,100,0,15)
    Menu.BackgroundColor3 = Color3.fromRGB(18,18,18)
    Menu.Active = true
    Menu.Draggable = true
    Menu.Visible = false
    Menu.ZIndex = 9998
    Instance.new("UICorner", Menu).CornerRadius = UDim.new(0,18)

    local Grad = Instance.new("UIGradient", Menu)
    Grad.Color = ColorSequence.new{Color3.fromRGB(40,10,60), Color3.fromRGB(10,10,25)}
    Grad.Rotation = 90

    local Stroke = Instance.new("UIStroke", Menu)
    Stroke.Color = Color3.fromRGB(255,50,150)
    Stroke.Thickness = 2
    Stroke.Transparency = 0.3

    local TitleMenu = Instance.new("TextLabel", Menu)
    TitleMenu.Size = UDim2.new(1,0,0,50)
    TitleMenu.BackgroundTransparency = 1
    TitleMenu.Text = "MIYOSHI"
    TitleMenu.TextColor3 = Color3.fromRGB(255,80,180)
    TitleMenu.Font = Enum.Font.GothamBlack
    TitleMenu.TextSize = 26
    TitleMenu.ZIndex = 9999

    -- TOMBOL AUTOFARM
    local ToggleBtn = Instance.new("TextButton", Menu)
    ToggleBtn.Size = UDim2.new(0,260,0,60)
    ToggleBtn.Position = UDim2.new(0,20,0,70)
    ToggleBtn.BackgroundColor3 = Color3.fromRGB(255,50,150)
    ToggleBtn.Text = "AutoFarm: OFF"
    ToggleBtn.TextColor3 = Color3.new(1,1,1)
    ToggleBtn.Font = Enum.Font.GothamBold
    ToggleBtn.TextSize = 24
    ToggleBtn.ZIndex = 9999
    Instance.new("UICorner", ToggleBtn).CornerRadius = UDim.new(0,12)

    -- KLIK B = MUNCUL MENU
    BBtn.MouseButton1Click:Connect(function()
        Menu.Visible = not Menu.Visible
    end)

    -- AUTOFARM KOORDINAT ONLY
    local AutoFarm = false
    local Coords = {Vector3.new(2879,4,-863), Vector3.new(-5,4,25), Vector3.new(3141,5,-111)}
    local idx = 1
    local deliveries = 0

    ToggleBtn.MouseButton1Click:Connect(function()
        AutoFarm = not AutoFarm
        ToggleBtn.Text = "AutoFarm: "..(AutoFarm and "ON" or "OFF")
    end)

    spawn(function()
        while task.wait(0.8) do
            if AutoFarm and LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
                local hrp = LocalPlayer.Character.HumanoidRootPart
                local target = Coords[idx]

                local tween = TweenService:Create(hrp, TweenInfo.new(0.6), {CFrame = CFrame.new(target + Vector3.new(0,6,0))})
                hrp.Anchored = true
                tween:Play()
                tween.Completed:Wait()
                hrp.Anchored = false

                task.wait(0.7)
                for _, p in workspace:GetDescendants() do
                    if p:IsA("ProximityPrompt") and (hrp.Position - p.Parent.Position).Magnitude < 30 then
                        fireproximityprompt(p, 5)
                        break
                    end
                end

                task.wait(6)
                deliveries += 1
                idx = idx % 3 + 1
                game.StarterGui:SetCore("SendNotification", {Title="Delivery #"..deliveries, Text="+15.000 Cash | +20 Coins", Duration=4})
            end
        end
    end)

    game.StarterGui:SetCore("SendNotification",{Title="MIYOSHI",Text="Bulatan B di kiri atas â€” klik untuk buka menu!",Duration=8})
end)
