--===== SERVICES =====--
local Players = game:GetService("Players")
local task = task

local lp = Players.LocalPlayer
local character = lp.Character or lp.CharacterAdded:Wait()
local root = character:WaitForChild("HumanoidRootPart")

--===== PATH DEALER =====--
local dealers = {
    workspace:WaitForChild("Etc"):WaitForChild("Dealership"),
    workspace:WaitForChild("Map"):WaitForChild("BSD2"):GetChildren()[1441]:WaitForChild("DealershipCars")
}

--===== VARIABLES =====--
local running = false
local delayTime = 5
local method = "RemoteEvent" -- default method

--===== SCREENGUI =====--
local gui = Instance.new("ScreenGui")
gui.Name = "DealerTesterUI"
gui.Parent = lp:WaitForChild("PlayerGui")
gui.IgnoreGuiInset = true

local main = Instance.new("Frame")
main.Size = UDim2.new(0, 300, 0, 200)
main.Position = UDim2.new(0, 50, 0, 50)
main.BackgroundColor3 = Color3.fromRGB(30,30,30)
main.BorderSizePixel = 0
main.Parent = gui

local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0,8)
UICorner.Parent = main

--===== STATUS LABEL =====--
local statusLabel = Instance.new("TextLabel")
statusLabel.Size = UDim2.new(1, -10, 0, 30)
statusLabel.Position = UDim2.new(0, 5, 0, 5)
statusLabel.BackgroundTransparency = 1
statusLabel.TextColor3 = Color3.new(1,1,1)
statusLabel.Font = Enum.Font.Gotham
statusLabel.TextSize = 14
statusLabel.Text = "Status: OFF"
statusLabel.Parent = main

--===== BUTTON ON/OFF =====--
local toggleBtn = Instance.new("TextButton")
toggleBtn.Size = UDim2.new(0, 250, 0, 30)
toggleBtn.Position = UDim2.new(0, 25, 0, 50)
toggleBtn.BackgroundColor3 = Color3.fromRGB(50,150,50)
toggleBtn.Text = "Start Auto Open Dealer"
toggleBtn.TextColor3 = Color3.new(1,1,1)
toggleBtn.Font = Enum.Font.GothamBold
toggleBtn.TextSize = 14
toggleBtn.Parent = main

--===== METHOD DROPDOWN =====--
local methodLabel = Instance.new("TextLabel")
methodLabel.Size = UDim2.new(1, -10, 0, 20)
methodLabel.Position = UDim2.new(0,5,0,90)
methodLabel.BackgroundTransparency = 1
methodLabel.TextColor3 = Color3.new(1,1,1)
methodLabel.Font = Enum.Font.Gotham
methodLabel.TextSize = 12
methodLabel.Text = "Method: "..method
methodLabel.Parent = main

local methodDropdown = Instance.new("TextButton")
methodDropdown.Size = UDim2.new(0, 120, 0, 20)
methodDropdown.Position = UDim2.new(0, 150, 0, 90)
methodDropdown.BackgroundColor3 = Color3.fromRGB(80,80,80)
methodDropdown.Text = method
methodDropdown.TextColor3 = Color3.new(1,1,1)
methodDropdown.Parent = main

local options = {"RemoteEvent", "RemoteFunction", "ProximityPrompt"}

methodDropdown.MouseButton1Click:Connect(function()
    local current = table.find(options, method)
    current = current % #options + 1
    method = options[current]
    methodDropdown.Text = method
    methodLabel.Text = "Method: "..method
end)

--===== SLIDER DELAY =====--
local sliderLabel = Instance.new("TextLabel")
sliderLabel.Size = UDim2.new(1, -10, 0, 20)
sliderLabel.Position = UDim2.new(0,5,0,120)
sliderLabel.BackgroundTransparency = 1
sliderLabel.TextColor3 = Color3.new(1,1,1)
sliderLabel.Font = Enum.Font.Gotham
sliderLabel.TextSize = 12
sliderLabel.Text = "Delay: "..delayTime.."s"
sliderLabel.Parent = main

local slider = Instance.new("TextBox")
slider.Size = UDim2.new(0, 100, 0, 20)
slider.Position = UDim2.new(0, 150, 0, 120)
slider.BackgroundColor3 = Color3.fromRGB(80,80,80)
slider.Text = tostring(delayTime)
slider.TextColor3 = Color3.new(1,1,1)
slider.Parent = main

slider.FocusLost:Connect(function(enter)
    local num = tonumber(slider.Text)
    if num and num >= 1 then
        delayTime = num
        sliderLabel.Text = "Delay: "..delayTime.."s"
    else
        slider.Text = tostring(delayTime)
    end
end)

--===== FUNCTION: Trigger Dealer =====--
local function triggerDealer(dealer)
    if method == "RemoteEvent" then
        local evt = dealer:FindFirstChild("OpenDealerEvent")
        if evt then
            evt:FireServer()
            print("Dealer dibuka via RemoteEvent:", dealer.Name)
        end
    elseif method == "RemoteFunction" then
        local func = dealer:FindFirstChild("OpenDealerFunction")
        if func then
            func:InvokeServer()
            print("Dealer dibuka via RemoteFunction:", dealer.Name)
        end
    elseif method == "ProximityPrompt" then
        local prompt = dealer:FindFirstChildWhichIsA("ProximityPrompt")
        if prompt then
            local origPos = root.Position
            root.CFrame = CFrame.new(dealer:GetModelCFrame().p + Vector3.new(0,5,0))
            prompt:InputHoldBegin()
            task.wait(1)
            prompt:InputHoldEnd()
            root.CFrame = CFrame.new(origPos)
            print("Dealer dibuka via ProximityPrompt:", dealer.Name)
        end
    end
end

--===== AUTO OPEN DEALER LOOP =====--
local autoOpenThread
toggleBtn.MouseButton1Click:Connect(function()
    running = not running
    if running then
        toggleBtn.Text = "Stop Auto Open Dealer"
        statusLabel.Text = "Status: ON"
        autoOpenThread = task.spawn(function()
            while running do
                for _, dealer in ipairs(dealers) do
                    if dealer then
                        triggerDealer(dealer)
                    end
                end
                task.wait(delayTime)
            end
        end)
    else
        toggleBtn.Text = "Start Auto Open Dealer"
        statusLabel.Text = "Status: OFF"
    end
end)
