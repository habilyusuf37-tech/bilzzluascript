local VirtualInputManager = game:GetService("VirtualInputManager")
local Players = game:GetService("Players")
local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoid = character:WaitForChild("Humanoid")

-- Koordinat waypoint
local Locations = {
	Vector3.new(2879, 4, -863),
	Vector3.new(-5, 4, 25),
	Vector3.new(3141, 5, -111)
}

local autofarm = false

-- Fungsi Teleport
local function teleportTo(pos)
	local root = character:WaitForChild("HumanoidRootPart")
	root.CFrame = CFrame.new(pos + Vector3.new(0, 3, 0))
end

-- Tekan E selama 7 detik
local function holdE()
	-- Tekan E (hold)
	VirtualInputManager:SendKeyEvent(true, Enum.KeyCode.E, false, game)

	-- tahan 7 detik
	task.wait(7)

	-- Lepas E
	VirtualInputManager:SendKeyEvent(false, Enum.KeyCode.E, false, game)
end

-- Cari waypoint marker otomatis
local function findWaypointMarker()
	for _, obj in ipairs(workspace:GetDescendants()) do
		if obj:IsA("BillboardGui") then
			if string.find(obj.Name:lower(), "way") or string.find(obj.Name:lower(), "mark") then
				return obj
			end
		end
	end
	return nil
end

-- AutoFarm utama
local function startAutoFarm()
	if autofarm then return end
	autofarm = true

	task.spawn(function()
		local index = 1

		while autofarm do
			local waypointPos = Locations[index]

			-- Teleport
			teleportTo(waypointPos)

			-- Delay sebelum tekan E (boleh kecil)
			task.wait(0.5)

			-- Hold E 7 detik
			holdE()

			-- Hapus marker jika ada
			local marker = findWaypointMarker()
			if marker then
				task.delay(5, function()
					if marker and marker.Parent then
						marker:Destroy()
					end
				end)
			end

			-- Delay teleport selanjutnya = 8 detik
			task.wait(8)

			-- Next waypoint
			index = index + 1
			if index > #Locations then
				index = 1
			end
		end
	end)
end

local function stopAutoFarm()
	autofarm = false
end

----------------------------------------------------------
-- GUI MENU
----------------------------------------------------------

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Parent = player.PlayerGui

local Frame = Instance.new("Frame")
Frame.Size = UDim2.new(0, 220, 0, 120)
Frame.Position = UDim2.new(0, 20, 0, 150)
Frame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
Frame.BackgroundTransparency = 0.2
Frame.Parent = ScreenGui

local UIStroke = Instance.new("UIStroke")
UIStroke.Color = Color3.fromRGB(255, 255, 255)
UIStroke.Thickness = 2
UIStroke.Parent = Frame

local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, 0, 0, 30)
title.Text = "AutoFarm Menu"
title.TextColor3 = Color3.new(1, 1, 1)
title.BackgroundTransparency = 1
title.Parent = Frame

local startBtn = Instance.new("TextButton")
startBtn.Size = UDim2.new(1, -20, 0, 35)
startBtn.Position = UDim2.new(0, 10, 0, 40)
startBtn.Text = "Start AutoFarm"
startBtn.TextColor3 = Color3.new(1, 1, 1)
startBtn.BackgroundColor3 = Color3.fromRGB(0, 120, 0)
startBtn.Parent = Frame

local stopBtn = Instance.new("TextButton")
stopBtn.Size = UDim2.new(1, -20, 0, 35)
stopBtn.Position = UDim2.new(0, 10, 0, 80)
stopBtn.Text = "Stop AutoFarm"
stopBtn.TextColor3 = Color3.new(1, 1, 1)
stopBtn.BackgroundColor3 = Color3.fromRGB(120, 0, 0)
stopBtn.Parent = Frame

startBtn.MouseButton1Click:Connect(startAutoFarm)
stopBtn.MouseButton1Click:Connect(stopAutoFarm)
