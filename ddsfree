-- AutoFarm TELEPORT Semua Waypoint + Auto Press E + Auto Equip
-- GUI Toggle ON/OFF merah-hijau

local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local player = Players.LocalPlayer

-- GUI Toggle Menu
local ScreenGui = Instance.new("ScreenGui", game.CoreGui)
ScreenGui.Name = "AutoFarmGUI"
ScreenGui.ResetOnSpawn = false

local ToggleButton = Instance.new("TextButton", ScreenGui)
ToggleButton.Size = UDim2.new(0,150,0,50)
ToggleButton.Position = UDim2.new(0.05,0,0.1,0)
ToggleButton.Text = "OFF"
ToggleButton.BackgroundColor3 = Color3.fromRGB(255,0,0)

local autoFarm = false
local delaySecs = 10
local currentIndex = 1
local suppressETrigger = false
local eDebounce = false

ToggleButton.MouseButton1Click:Connect(function()
    autoFarm = not autoFarm
    if autoFarm then
        ToggleButton.Text = "ON"
        ToggleButton.BackgroundColor3 = Color3.fromRGB(0,255,0)
    else
        ToggleButton.Text = "OFF"
        ToggleButton.BackgroundColor3 = Color3.fromRGB(255,0,0)
    end
end)

-- Semua waypoint TELEPORT (1â€“6)
local waypoints = {
    Vector3.new(-5111, 5, -3760),
    Vector3.new(-6795, 3, -444),
    Vector3.new(-17053, 104, 6567),
    Vector3.new(-6741, 3, 2975),
    Vector3.new(-8777, 3, 644),
    Vector3.new(-8382, 2, -3822)
}

-- Teleport CFrame langsung
local function teleportTo(pos)
    local char = player.Character or player.CharacterAdded:Wait()
    local hrp = char:FindFirstChild("HumanoidRootPart") or char:WaitForChild("HumanoidRootPart", 5)
    if hrp then
        hrp.CFrame = CFrame.new(pos + Vector3.new(0,2,0))
    end
end

-- Auto tekan E (Anti trigger ulang)
local function autoPressE()
    for _, obj in ipairs(workspace:GetDescendants()) do
        if obj:IsA("ProximityPrompt") then
            pcall(fireproximityprompt, obj)
        end
    end
    suppressETrigger = true
    local vim = game:GetService("VirtualInputManager")
    pcall(function()
        vim:SendKeyEvent(true, "E", false, game)
        task.wait(0.1)
        vim:SendKeyEvent(false, "E", false, game)
    end)
    task.delay(0.3, function() suppressETrigger = false end)
end

-- Auto equip tool
local function autoEquip()
    local backpack = player:FindFirstChild("Backpack")
    if not backpack then return end
    for _, tool in ipairs(backpack:GetChildren()) do
        if tool:IsA("Tool") then
            pcall(function()
                tool.Parent = player.Character
            end)
            return
        end
    end
end

-- Tekan E Manual hanya jika autoFarm OFF
UserInputService.InputBegan:Connect(function(input, processed)
    if processed then return end
    if input.KeyCode == Enum.KeyCode.E and not suppressETrigger then
        if not autoFarm then
            currentIndex = 1
            teleportTo(waypoints[1])
        end
    end
end)

-- MAIN LOOP AutoFarm
task.spawn(function()
    while true do
        if autoFarm then
            if currentIndex > #waypoints then currentIndex = 1 end

            -- TELEPORT LANGSUNG
            teleportTo(waypoints[currentIndex])
            task.wait(0.4)

            -- Auto press E + auto equip
            autoPressE()
            task.wait(0.2)
            autoEquip()

            -- Delay 10 detik
            for s = delaySecs, 1, -1 do
                if not autoFarm then break end
                task.wait(1)
            end

            -- Next waypoint
            currentIndex = currentIndex + 1
            if currentIndex > #waypoints then
                currentIndex = 1
            end
        end
        task.wait(0.4)
    end
end)
