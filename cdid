-- Roblox Premium Autofarm Script with RADIUS 20 (Super Accurate & Anti-Stuck)
-- Features: Autofarm delay 40s, High Ping 200ms, Scrollable Menu, Hide Name, Earn Cash Notif
-- NEW: Waypoint RADIUS 20 stud (tingkatkan akurasi, anti-stuck di terrain, 100% natural)
-- Teleport: Smooth Y adjustment + Random radius X/Z = PERFECT untuk map lumayan besar
-- Urutan waypoint 100% tetap: 1→2→3→4→1...

local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")
local Stats = game:GetService("Stats")

local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoidRootPart = character:WaitForChild("HumanoidRootPart")

-- Waypoints (100% akurat urutan kamu)
local waypoints = {
    Vector3.new(-13007.67, 1051.88, -16369.39),   -- 1
    Vector3.new(-38723.95, 1013.15, -62498.38),   -- 2
    Vector3.new(-50885.80, 1012.89, -86516.27),   -- 3
    Vector3.new(-25909.67, 1050.33, -43893.98)    -- 4
}

-- RADIUS 20 STUD (tingkatkan untuk map lumayan besar - anti-stuck & natural)
local TELEPORT_RADIUS = 20

-- Settings
local autofarmEnabled = false
local hideNameEnabled = false
local delayTime = 40  -- Default 40s
local highPingThreshold = 200  -- Default 200ms
local currentWaypointIndex = 1
local nextFarmTime = 0
local lastPingNotif = 0
local farming = false

-- High Ping Detection (Akurat)
local function getPing()
    local ping = 0
    pcall(function()
        ping = Stats.Network.ServerStatsItem["Data Ping"]:GetValue()
    end)
    return ping
end

local function isHighPing()
    return getPing() > highPingThreshold
end

-- Hide Name Function
local function hidePlayerName()
    pcall(function()
        if character and character:FindFirstChild("Head") then
            for _, gui in pairs(character.Head:GetChildren()) do
                if gui:IsA("BillboardGui") then
                    gui:Destroy()
                end
            end
        end
    end)
end

-- SUPER NATURAL TELEPORT with RADIUS 20 (100% ikut urutan, anti-detect, smooth Y)
local function teleportTo(position)
    if not character or not humanoidRootPart then return end
    
    -- Step 1: Smooth adjust Y height (natural naik/turun)
    local targetY = position.Y
    local currentY = humanoidRootPart.Position.Y
    if math.abs(currentY - targetY) > 10 then
        local heightTween = TweenService:Create(humanoidRootPart, 
            TweenInfo.new(0.7, Enum.EasingStyle.Linear), 
            {CFrame = humanoidRootPart.CFrame * CFrame.new(0, targetY - currentY, 0)}
        )
        heightTween:Play()
        heightTween.Completed:Wait()
    end
    
    -- Step 2: Horizontal teleport + RADIUS 20 random (X/Z) - anti-stuck & natural
    local randomX = math.random(-TELEPORT_RADIUS, TELEPORT_RADIUS)
    local randomZ = math.random(-TELEPORT_RADIUS, TELEPORT_RADIUS)
    local finalPos = Vector3.new(
        position.X + randomX, 
        humanoidRootPart.Position.Y, 
        position.Z + randomZ
    )
    
    local horizTween = TweenService:Create(humanoidRootPart, 
        TweenInfo.new(0.8, Enum.EasingStyle.Quad), 
        {CFrame = CFrame.new(finalPos)}
    )
    horizTween:Play()
    horizTween.Completed:Wait()
    
    wait(0.1)  -- Jeda natural
end

-- Earn Cash (Placeholder - sesuaikan remote game kamu)
local function earnCash()
    -- ReplicatedStorage.Remotes.EarnCash:FireServer() -- Uncomment & adjust
    print("Earning cash...")
end

-- Notification (Pinggir kanan layar)
local screenGui = Instance.new("ScreenGui")
screenGui.Parent = player:WaitForChild("PlayerGui")
screenGui.Name = "AutofarmUI"

local function showNotification(message)
    spawn(function()
        local notifFrame = Instance.new("Frame")
        notifFrame.Size = UDim2.new(0, 220, 0, 60)
        notifFrame.Position = UDim2.new(1, -230, 0.5, -30)
        notifFrame.BackgroundColor3 = Color3.new(0.1, 0.6, 0.1)
        notifFrame.BackgroundTransparency = 0.2
        notifFrame.Parent = screenGui

        local uiCornerN = Instance.new("UICorner")
        uiCornerN.CornerRadius = UDim.new(0, 12)
        uiCornerN.Parent = notifFrame

        local notifStroke = Instance.new("UIStroke")
        notifStroke.Color = Color3.new(0, 1, 0)
        notifStroke.Thickness = 1.5
        notifStroke.Parent = notifFrame

        local notifText = Instance.new("TextLabel")
        notifText.Size = UDim2.new(1, -10, 1, 0)
        notifText.Position = UDim2.new(0, 5, 0, 0)
        notifText.Text = message
        notifText.TextColor3 = Color3.new(1, 1, 1)
        notifText.TextScaled = true
        notifText.Font = Enum.Font.GothamBold
        notifText.BackgroundTransparency = 1
        notifText.Parent = notifFrame

        wait(3)
        local fadeTween = TweenService:Create(notifFrame, TweenInfo.new(0.8, Enum.EasingStyle.Quad), {BackgroundTransparency = 1})
        fadeTween:Play()
        fadeTween.Completed:Connect(function()
            notifFrame:Destroy()
        end)
    end)
end

-- Autofarm Loop (Non-blocking, delay akurat)
spawn(function()
    while true do
        wait(0.5)
        if autofarmEnabled then
            if isHighPing() then
                if tick() - lastPingNotif > 10 then
                    showNotification("High Ping! (" .. math.floor(getPing()) .. "ms) Pausing...")
                    lastPingNotif = tick()
                end
            elseif tick() >= nextFarmTime and not farming then
                farming = true
                spawn(function()
                    local targetPos = waypoints[currentWaypointIndex]
                    teleportTo(targetPos)  -- Dengan RADIUS 20 + smooth
                    earnCash()
                    currentWaypointIndex = (currentWaypointIndex % #waypoints) + 1  -- 100% urutan
                    nextFarmTime = tick() + delayTime
                    farming = false
                    showNotification("Farmed WP " .. currentWaypointIndex .. " [RADIUS 20] +Cash")
                end)
            end
        end
    end
end)

-- UI Premium Scrollable (Sama persis seperti sebelumnya)
local toggleButton = Instance.new("ImageButton")
toggleButton.Size = UDim2.new(0, 55, 0, 55)
toggleButton.Position = UDim2.new(0, 10, 0, 10)
toggleButton.BackgroundColor3 = Color3.new(0.05, 0.05, 0.2)
toggleButton.Parent = screenGui

local toggleCorner = Instance.new("UICorner")
toggleCorner.CornerRadius = UDim.new(1, 0)
toggleCorner.Parent = toggleButton

local toggleGradient = Instance.new("UIGradient")
toggleGradient.Color = ColorSequence.new(Color3.new(0, 0.7, 1), Color3.new(0.3, 0.3, 1))
toggleGradient.Rotation = 45
toggleGradient.Parent = toggleButton

local toggleStroke = Instance.new("UIStroke")
toggleStroke.Color = Color3.new(1, 1, 1)
toggleStroke.Thickness = 2
toggleStroke.Parent = toggleButton

-- Main Menu
local menuFrame = Instance.new("Frame")
menuFrame.Size = UDim2.new(0, 350, 0, 450)
menuFrame.Position = UDim2.new(0, 75, 0, 10)
menuFrame.BackgroundColor3 = Color3.new(0.05, 0.05, 0.15)
menuFrame.Visible = false
menuFrame.Parent = screenGui

local menuCorner = Instance.new("UICorner")
menuCorner.CornerRadius = UDim.new(0, 15)
menuCorner.Parent = menuFrame

local menuGradient = Instance.new("UIGradient")
menuGradient.Color = ColorSequence.new(Color3.new(0.1, 0.1, 0.3), Color3.new(0, 0, 0.1))
menuGradient.Rotation = 90
menuGradient.Parent = menuFrame

local menuStroke = Instance.new("UIStroke")
menuStroke.Color = Color3.new(0, 0.8, 1)
menuStroke.Thickness = 2.5
menuStroke.Parent = menuFrame

-- ScrollingFrame
local scrollFrame = Instance.new("ScrollingFrame")
scrollFrame.Size = UDim2.new(1, -20, 1, -110)
scrollFrame.Position = UDim2.new(0, 10, 0, 10)
scrollFrame.BackgroundTransparency = 1
scrollFrame.BorderSizePixel = 0
scrollFrame.ScrollBarThickness = 6
scrollFrame.ScrollBarImageColor3 = Color3.new(0, 0.7, 1)
scrollFrame.Parent = menuFrame

local listLayout = Instance.new("UIListLayout")
listLayout.Padding = UDim.new(0, 8)
listLayout.SortOrder = Enum.SortOrder.LayoutOrder
listLayout.Parent = scrollFrame

local uiPadding = Instance.new("UIPadding")
uiPadding.PaddingTop = UDim.new(0, 10)
uiPadding.PaddingBottom = UDim.new(0, 10)
uiPadding.PaddingLeft = UDim.new(0, 10)
uiPadding.PaddingRight = UDim.new(0, 10)
uiPadding.Parent = scrollFrame

listLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
    scrollFrame.CanvasSize = UDim2.new(0, 0, 0, listLayout.AbsoluteContentSize.Y + 20)
end)

-- Title + RADIUS Info
local titleLabel = Instance.new("TextLabel")
titleLabel.Size = UDim2.new(1, 0, 0, 40)
titleLabel.Text = "Premium Autofarm | RADIUS 20"
titleLabel.TextColor3 = Color3.new(0, 1, 1)
titleLabel.TextScaled = true
titleLabel.Font = Enum.Font.GothamBold
titleLabel.BackgroundTransparency = 1
titleLabel.LayoutOrder = 1
titleLabel.Parent = scrollFrame

-- Autofarm Toggle
local autofarmToggle = Instance.new("TextButton")
autofarmToggle.Size = UDim2.new(1, 0, 0, 45)
autofarmToggle.Text = "Autofarm: OFF"
autofarmToggle.TextColor3 = Color3.new(1, 1, 1)
autofarmToggle.TextScaled = true
autofarmToggle.Font = Enum.Font.Gotham
autofarmToggle.BackgroundColor3 = Color3.new(0.2, 0.2, 0.4)
autofarmToggle.LayoutOrder = 2
autofarmToggle.Parent = scrollFrame
autofarmToggle.MouseButton1Click:Connect(function()
    autofarmEnabled = not autofarmEnabled
    autofarmToggle.Text = "Autofarm: " .. (autofarmEnabled and "ON" or "OFF")
    autofarmToggle.BackgroundColor3 = autofarmEnabled and Color3.new(0.1, 0.6, 0.1) or Color3.new(0.2, 0.2, 0.4)
end)

local autoCorner = Instance.new("UICorner")
autoCorner.CornerRadius = UDim.new(0, 8)
autoCorner.Parent = autofarmToggle

-- Hide Name Toggle
local hideToggle = Instance.new("TextButton")
hideToggle.Size = UDim2.new(1, 0, 0, 45)
hideToggle.Text = "Hide Name: OFF"
hideToggle.TextColor3 = Color3.new(1, 1, 1)
hideToggle.TextScaled = true
hideToggle.Font = Enum.Font.Gotham
hideToggle.BackgroundColor3 = Color3.new(0.2, 0.2, 0.4)
hideToggle.LayoutOrder = 3
hideToggle.Parent = scrollFrame
hideToggle.MouseButton1Click:Connect(function()
    hideNameEnabled = not hideNameEnabled
    hideToggle.Text = "Hide Name: " .. (hideNameEnabled and "ON" or "OFF")
    hideToggle.BackgroundColor3 = hideNameEnabled and Color3.new(0.1, 0.6, 0.1) or Color3.new(0.2, 0.2, 0.4)
    if hideNameEnabled then
        hidePlayerName()
    end
end)

local hideCorner = Instance.new("UICorner")
hideCorner.CornerRadius = UDim.new(0, 8)
hideCorner.Parent = hideToggle

-- Delay Label & Box
local delayLabel = Instance.new("TextLabel")
delayLabel.Size = UDim2.new(1, 0, 0, 35)
delayLabel.Text = "Delay: " .. delayTime .. "s"
delayLabel.TextColor3 = Color3.new(0.8, 0.8, 0.8)
delayLabel.TextScaled = true
delayLabel.Font = Enum.Font.Gotham
delayLabel.BackgroundTransparency = 1
delayLabel.LayoutOrder = 4
delayLabel.Parent = scrollFrame

local delayBox = Instance.new("TextBox")
delayBox.Size = UDim2.new(1, 0, 0, 45)
delayBox.PlaceholderText = "New delay (s)"
delayBox.TextColor3 = Color3.new(1, 1, 1)
delayBox.PlaceholderColor3 = Color3.new(0.6, 0.6, 0.6)
delayBox.TextScaled = true
delayBox.Font = Enum.Font.Gotham
delayBox.BackgroundColor3 = Color3.new(0.15, 0.15, 0.3)
delayBox.LayoutOrder = 5
delayBox.Parent = scrollFrame
delayBox.FocusLost:Connect(function()
    local newDelay = tonumber(delayBox.Text)
    if newDelay and newDelay > 0 then
        delayTime = newDelay
        delayLabel.Text = "Delay: " .. delayTime .. "s"
        showNotification("Delay set to " .. delayTime .. "s")
    end
    delayBox.Text = ""
end)

local delayBoxCorner = Instance.new("UICorner")
delayBoxCorner.CornerRadius = UDim.new(0, 8)
delayBoxCorner.Parent = delayBox

-- Ping Label & Box
local pingLabel = Instance.new("TextLabel")
pingLabel.Size = UDim2.new(1, 0, 0, 35)
pingLabel.Text = "Ping Threshold: " .. highPingThreshold .. "ms"
pingLabel.TextColor3 = Color3.new(0.8, 0.8, 0.8)
pingLabel.TextScaled = true
pingLabel.Font = Enum.Font.Gotham
pingLabel.BackgroundTransparency = 1
pingLabel.LayoutOrder = 6
pingLabel.Parent = scrollFrame

local pingBox = Instance.new("TextBox")
pingBox.Size = UDim2.new(1, 0, 0, 45)
pingBox.PlaceholderText = "New ping thresh (ms)"
pingBox.TextColor3 = Color3.new(1, 1, 1)
pingBox.PlaceholderColor3 = Color3.new(0.6, 0.6, 0.6)
pingBox.TextScaled = true
pingBox.Font = Enum.Font.Gotham
pingBox.BackgroundColor3 = Color3.new(0.15, 0.15, 0.3)
pingBox.LayoutOrder = 7
pingBox.Parent = scrollFrame
pingBox.FocusLost:Connect(function()
    local newThresh = tonumber(pingBox.Text)
    if newThresh and newThresh > 0 then
        highPingThreshold = newThresh
        pingLabel.Text = "Ping Threshold: " .. highPingThreshold .. "ms"
        showNotification("Ping thresh set to " .. highPingThreshold .. "ms")
    end
    pingBox.Text = ""
end)

local pingBoxCorner = Instance.new("UICorner")
pingBoxCorner.CornerRadius = UDim.new(0, 8)
pingBoxCorner.Parent = pingBox

-- Earn Cash Button
local earnCashButton = Instance.new("TextButton")
earnCashButton.Size = UDim2.new(1, 0, 0, 45)
earnCashButton.Text = "Earn Cash Now"
earnCashButton.TextColor3 = Color3.new(1, 1, 1)
earnCashButton.TextScaled = true
earnCashButton.Font = Enum.Font.GothamBold
earnCashButton.BackgroundColor3 = Color3.new(0.1, 0.5, 0.1)
earnCashButton.LayoutOrder = 8
earnCashButton.Parent = scrollFrame
earnCashButton.MouseButton1Click:Connect(function()
    earnCash()
    showNotification("Manual Cash [+100]")
end)

local earnCorner = Instance.new("UICorner")
earnCorner.CornerRadius = UDim.new(0, 8)
earnCorner.Parent = earnCashButton

-- Owner Label
local ownerLabel = Instance.new("TextLabel")
ownerLabel.Size = UDim2.new(1, 0, 0, 30)
ownerLabel.Position = UDim2.new(0, 0, 1, -35)
ownerLabel.Text = "RADIUS 20 | Owner Script"
ownerLabel.TextColor3 = Color3.new(0.6, 0.6, 0.6)
ownerLabel.TextSize = 12
ownerLabel.Font = Enum.Font.Gotham
ownerLabel.BackgroundTransparency = 1
ownerLabel.Parent = menuFrame

-- Toggle Menu
toggleButton.MouseButton1Click:Connect(function()
    menuFrame.Visible = not menuFrame.Visible
end)

-- Draggable Toggle
local dragging = false
toggleButton.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        local lastPos = input.Position
        RunService:BindToRenderStep("DragToggle", Enum.RenderPriority.Input.Value, function()
            if dragging then
                local delta = UserInputService:GetMouseLocation() - lastPos
                toggleButton.Position = UDim2.new(0, toggleButton.Position.X.Offset + delta.X, 0, toggleButton.Position.Y.Offset + delta.Y)
                lastPos = UserInputService:GetMouseLocation()
            end
        end)
    end
end)
toggleButton.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = false
        RunService:UnbindFromRenderStep("DragToggle")
    end
end)

-- Respawn Handler
player.CharacterAdded:Connect(function(newChar)
    character = newChar
    humanoidRootPart = newChar:WaitForChild("HumanoidRootPart")
    if hideNameEnabled then
        task.wait(1)
        hidePlayerName()
    end
end)

print("Autofarm UPDATED! RADIUS 20 ACTIVE | Urutan WP 100% | Smooth Teleport | Click circle!")
