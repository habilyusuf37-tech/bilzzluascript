-- FINAL + SMART WAYPOINT DETECTION (Auto cek ada barang/cash/NPC di WP)
-- Teleport EXACT + Job Truck aman + Premium by Bill + Countdown + UI Horizontal ON/OFF

local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")

local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoidRootPart = character:WaitForChild("HumanoidRootPart")

-- WAYPOINT 100% EXACT (koordinat kamu)
local waypoints = {
    Vector3.new(-13007.67, 1051.88, -16369.39),
    Vector3.new(-38723.95, 1013.15, -62498.38),
    Vector3.new(-50885.80, 1012.89, -86516.27),
    Vector3.new(-25909.67, 1050.33, -43893.98)
}

local jobTruckPos = Vector3.new(-21795.81, 1052.03, -26799.80)  -- Anti void
local DETECTION_RADIUS = 60   -- Radius deteksi (bisa diubah)
local MAX_WAIT_TIME = 30      -- Max tunggu 30 detik kalau tidak ada object

local autofarmEnabled = false
local premiumBillEnabled = false
local delayTime = 40
local currentWaypointIndex = 1

-- DETEKSI APA SAJA YANG DIANGGAP "ADA" DI WAYPOINT
local function isWaypointDetected(pos)
    local region = Region3.new(pos - Vector3.new(DETECTION_RADIUS, 50, DETECTION_RADIUS),
                               pos + Vector3.new(DETECTION_RADIUS, 50, DETECTION_RADIUS))
    local parts = Workspace:FindPartsInRegion3(region, character, 50)
    
    for _, part in pairs(parts) do
        if part and part.Parent and (
            part.Name:lower():find("cash") or
            part.Name:lower():find("money") or
            part.Name:lower():find("drop") or
            part.Name:lower():find("package") or
            part.Name:lower():find("crate") or
            part.Name:lower():find("box") or
            part:IsA("MeshPart") or part:IsA("Part") and part.Transparency < 1
        ) then
            return true
        end
    end
    return false
end

-- Teleport EXACT
local function teleportExact(pos)
    if not humanoidRootPart then return end
    humanoidRootPart.CFrame = CFrame.new(pos + Vector3.new(0, 8, 0))  -- +8 Y biar aman
end

-- Hide Name (Premium by Bill)
spawn(function()
    while task.wait(0.7) do
        if premiumBillEnabled and character and character:FindFirstChild("Head") then
            for _, v in pairs(character.Head:GetChildren()) do
                if v:IsA("BillboardGui") then v:Destroy() end
            end
        end
    end
end)

-- Notifikasi
local screenGui = Instance.new("ScreenGui", player.PlayerGui)
local function notif(text)
    spawn(function()
        local n = Instance.new("TextLabel", screenGui)
        n.Size = UDim2.new(0, 360, 0, 70)
        n.Position = UDim2.new(0.5, -180, 0, -80)
        n.BackgroundColor3 = Color3.fromRGB(10, 90, 10)
        n.Text = text
        n.TextColor3 = Color3.new(1,1,1)
        n.TextScaled = true
        n.Font = Enum.Font.GothamBold
        n.BackgroundTransparency = 0.2
        Instance.new("UICorner", n).CornerRadius = UDim.new(0,16)
        Instance.new("UIStroke", n).Color = Color3.new(0,1,0); Instance.new("UIStroke", n).Thickness = 3
        TweenService:Create(n, TweenInfo.new(0.5), {Position = UDim2.new(0.5,-180,0,30)}):Play()
        task.wait(3)
        TweenService:Create(n, TweenInfo.new(0.5), {Position = UDim2.new(0.5,-180,0,-80)}):Play()
        task.wait(0.6); n:Destroy()
    end)
end

-- SMART AUTOFARM + DETECTION
spawn(function()
    while task.wait(1) do
        if autofarmEnabled then
            -- Countdown
            for i = delayTime, 0, -1 do
                if not autofarmEnabled then break end
                notif("Next Delivery: "..i.."s")
                task.wait(1)
            end

            if not autofarmEnabled then continue end

            local target = waypoints[currentWaypointIndex]
            teleportExact(target)
            notif("Arrived WP "..currentWaypointIndex.." â†’ Scanning...")

            -- TUNGGU SAMPAI DETEKSI ADA BARANG
            local detected = false
            for waitTime = 1, MAX_WAIT_TIME do
                if isWaypointDetected(target) then
                    detected = true
                    notif("Detected! WP "..currentWaypointIndex.." Success!")
                    break
                end
                notif("Scanning WP "..currentWaypointIndex..": "..waitTime.."s")
                task.wait(1)
            end

            if not detected then
                notif("Timeout! Skip WP "..currentWaypointIndex)
            end

            currentWaypointIndex = (currentWaypointIndex % #waypoints) + 1
        end
    end
end)

-- UI Horizontal + ON/OFF Switch
local toggleBtn = Instance.new("ImageButton", screenGui)
toggleBtn.Size = UDim2.new(0,70,0,70)
toggleBtn.Position = UDim2.new(0,10,0,10)
toggleBtn.BackgroundColor3 = Color3.fromRGB(10,10,60)
Instance.new("UICorner", toggleBtn).CornerRadius = UDim.new(1,0)
Instance.new("UIGradient", toggleBtn).Color = ColorSequence.new(Color3.fromRGB(0,180,255), Color3.fromRGB(180,50,255))

local menu = Instance.new("Frame", screenGui)
menu.Size = UDim2.new(0.96,0,0,130)
menu.Position = UDim2.new(0.02,0,0,90)
menu.BackgroundColor3 = Color3.fromRGB(12,12,45)
menu.Visible = false
Instance.new("UICorner", menu).CornerRadius = UDim.new(0,20)
Instance.new("UIStroke", menu).Color = Color3.fromRGB(0,230,255); Instance.new("UIStroke", menu).Thickness = 3

local layout = Instance.new("UIListLayout", menu)
layout.FillDirection = Enum.FillDirection.Horizontal
layout.Padding = UDim.new(0,20)
layout.VerticalAlignment = Enum.VerticalAlignment.Center

local function addSwitch(name, varName, callback)
    local frame = Instance.new("Frame", menu)
    frame.Size = UDim2.new(0,140,0,90)
    frame.BackgroundTransparency = 1

    local label = Instance.new("TextLabel", frame)
    label.Size = UDim2.new(0,80,1,0)
    label.Text = name
    label.TextColor3 = Color3.new(1,1,1)
    label.TextScaled = true
    label.BackgroundTransparency = 1

    local btn = Instance.new("TextButton", frame)
    btn.Position = UDim2.new(1,-50,0.5,-20)
    btn.Size = UDim2.new(0,90,0,40)
    btn.Text = "OFF"
    btn.BackgroundColor3 = Color3.fromRGB(90,20,20)
    Instance.new("UICorner", btn).CornerRadius = UDim.new(0,20)
    btn.MouseButton1Click:Connect(function()
        _G[varName] = not _G[varName]
        btn.Text = _G[varName] and "ON" or "OFF"
        btn.BackgroundColor3 = _G[varName] and Color3.fromRGB(20,100,20) or Color3.fromRGB(90,20,20)
        if callback then callback() end
    end)
end

_G.autofarmEnabled = false
_G.premiumBillEnabled = false

addSwitch("Autofarm", "autofarmEnabled")
addSwitch("Premium\nby Bill", "premiumBillEnabled")
addSwitch("Delay\n"..delayTime.."s", nil, function()
    delayTime = ({40,30,55})[(delayTime == 40 and 2) or (delayTime == 30 and 3) or 1]
end)

local jobBtn = Instance.new("TextButton", menu)
jobBtn.Size = UDim2.new(0,140,0,90)
jobBtn.BackgroundColor3 = Color3.fromRGB(20,80,150)
jobBtn.Text = "Job Truck\nTP"
jobBtn.TextColor3 = Color3.new(1,1,1)
jobBtn.TextScaled = true
Instance.new("UICorner", jobBtn).CornerRadius = UDim.new(0,16)
jobBtn.MouseButton1Click:Connect(function()
    teleportExact(jobTruckPos)
    notif("Teleported to Job Truck")
end)

toggleBtn.MouseButton1Click:Connect(function()
    menu.Visible = not menu.Visible
end)

player.CharacterAdded:Connect(function(c)
    character = c
    humanoidRootPart = c:WaitForChild("HumanoidRootPart")
end)

notif("SMART WAYPOINT DETECTION ACTIVE!")
