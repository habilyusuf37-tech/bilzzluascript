-- Roblox Autofarm Script with UI Menu
-- Features: Autofarm with 55s delay, High Ping Detection, Earn Cash, Delay Settings, Accurate Waypoints
-- UI: Toggle menu with a circle button in top-left corner
-- Note: This script assumes you're using a Roblox executor that supports GUI (e.g., Synapse, Krnl). Run in LocalScript.

local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local HttpService = game:GetService("HttpService")  -- For potential API calls if needed
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")

local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoidRootPart = character:WaitForChild("HumanoidRootPart")

-- Waypoints (100% accurate with provided coordinates)
local waypoints = {
    Vector3.new(-13007.67, 1051.88, -16369.39),
    Vector3.new(-38723.95, 1013.15, -62498.38),
    Vector3.new(-50885.80, 1012.89, -86516.27),
    Vector3.new(-25909.67, 1050.33, -43893.98)
}

-- Settings
local autofarmEnabled = false
local delayTime = 55  -- Default delay in seconds
local highPingThreshold = 200  -- Ping above this pauses autofarm (in ms)
local currentWaypointIndex = 1

-- High Ping Detection Function
local function getPing()
    -- Approximate ping using NetworkSettings or a simple method
    local stats = game:GetService("NetworkClient"):GetNetworkStats()
    return stats.Ping  -- This might need adjustment based on Roblox API changes
end

local function isHighPing()
    return getPing() > highPingThreshold
end

-- Teleport Function (Accurate with Tween for smoothness)
local function teleportTo(position)
    if not character or not humanoidRootPart then return end
    local tweenInfo = TweenInfo.new(1, Enum.EasingStyle.Linear)  -- Adjust time for smoothness
    local tween = TweenService:Create(humanoidRootPart, tweenInfo, {CFrame = CFrame.new(position)})
    tween:Play()
    tween.Completed:Wait()
end

-- Earn Cash Function (Placeholder - Customize based on game, e.g., invoke remote for cash)
local function earnCash()
    -- Example: Fire a remote event to earn cash (replace with actual game remote)
    -- ReplicatedStorage.Remotes.EarnCash:FireServer(100)  -- Uncomment and adjust
    print("Earning cash...")  -- Placeholder
end

-- Autofarm Loop
spawn(function()
    while true do
        if autofarmEnabled then
            if isHighPing() then
                print("High ping detected! Pausing autofarm...")
                wait(10)  -- Wait before checking again
            else
                local targetPos = waypoints[currentWaypointIndex]
                teleportTo(targetPos)
                earnCash()  -- Earn cash at waypoint
                currentWaypointIndex = currentWaypointIndex % #waypoints + 1
                wait(delayTime)
            end
        end
        wait(1)  -- Loop check interval
    end
end)

-- UI Setup (Using ScreenGui with Circle Button for Toggle)
local screenGui = Instance.new("ScreenGui")
screenGui.Parent = player:WaitForChild("PlayerGui")
screenGui.Name = "AutofarmUI"

-- Toggle Button (Circle in top-left corner)
local toggleButton = Instance.new("ImageButton")
toggleButton.Size = UDim2.new(0, 50, 0, 50)
toggleButton.Position = UDim2.new(0, 10, 0, 10)
toggleButton.BackgroundColor3 = Color3.new(0, 0, 0)
toggleButton.BackgroundTransparency = 0.5
toggleButton.Image = "rbxassetid://0"  -- No image for circle, use corner radius
local uiCorner = Instance.new("UICorner")
uiCorner.CornerRadius = UDim.new(1, 0)  -- Full circle
uiCorner.Parent = toggleButton
toggleButton.Parent = screenGui

-- Main Menu Frame (Hidden initially)
local menuFrame = Instance.new("Frame")
menuFrame.Size = UDim2.new(0, 300, 0, 400)
menuFrame.Position = UDim2.new(0, 70, 0, 10)
menuFrame.BackgroundColor3 = Color3.new(0.1, 0.1, 0.1)
menuFrame.Visible = false
menuFrame.Parent = screenGui

-- Add UI Corner to menu for rounded edges
local menuCorner = Instance.new("UICorner")
menuCorner.Parent = menuFrame

-- Toggle Autofarm Button
local autofarmToggle = Instance.new("TextButton")
autofarmToggle.Size = UDim2.new(1, 0, 0, 50)
autofarmToggle.Position = UDim2.new(0, 0, 0, 0)
autofarmToggle.Text = "Autofarm: OFF"
autofarmToggle.Parent = menuFrame
autofarmToggle.MouseButton1Click:Connect(function()
    autofarmEnabled = not autofarmEnabled
    autofarmToggle.Text = "Autofarm: " .. (autofarmEnabled and "ON" or "OFF")
end)

-- Delay Setting TextBox
local delayLabel = Instance.new("TextLabel")
delayLabel.Size = UDim2.new(1, 0, 0, 50)
delayLabel.Position = UDim2.new(0, 0, 0, 50)
delayLabel.Text = "Delay Time: " .. delayTime .. "s"
delayLabel.Parent = menuFrame

local delayBox = Instance.new("TextBox")
delayBox.Size = UDim2.new(1, 0, 0, 50)
delayBox.Position = UDim2.new(0, 0, 0, 100)
delayBox.PlaceholderText = "Enter new delay (seconds)"
delayBox.Parent = menuFrame
delayBox.FocusLost:Connect(function()
    local newDelay = tonumber(delayBox.Text)
    if newDelay then
        delayTime = newDelay
        delayLabel.Text = "Delay Time: " .. delayTime .. "s"
    end
    delayBox.Text = ""
end)

-- High Ping Threshold Setting
local pingLabel = Instance.new("TextLabel")
pingLabel.Size = UDim2.new(1, 0, 0, 50)
pingLabel.Position = UDim2.new(0, 0, 0, 150)
pingLabel.Text = "High Ping Threshold: " .. highPingThreshold .. "ms"
pingLabel.Parent = menuFrame

local pingBox = Instance.new("TextBox")
pingBox.Size = UDim2.new(1, 0, 0, 50)
pingBox.Position = UDim2.new(0, 0, 0, 200)
pingBox.PlaceholderText = "Enter new ping threshold (ms)"
pingBox.Parent = menuFrame
pingBox.FocusLost:Connect(function()
    local newThreshold = tonumber(pingBox.Text)
    if newThreshold then
        highPingThreshold = newThreshold
        pingLabel.Text = "High Ping Threshold: " .. highPingThreshold .. "ms"
    end
    pingBox.Text = ""
end)

-- Earn Cash Button
local earnCashButton = Instance.new("TextButton")
earnCashButton.Size = UDim2.new(1, 0, 0, 50)
earnCashButton.Position = UDim2.new(0, 0, 0, 250)
earnCashButton.Text = "Earn Cash Now"
earnCashButton.Parent = menuFrame
earnCashButton.MouseButton1Click:Connect(earnCash)

-- Toggle Menu Visibility
toggleButton.MouseButton1Click:Connect(function()
    menuFrame.Visible = not menuFrame.Visible
end)

-- Make toggle button draggable (optional)
local dragging = false
toggleButton.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        local lastPos = input.Position
        RunService:BindToRenderStep("Drag", Enum.RenderPriority.Input.Value, function()
            if not dragging then return end
            local delta = UserInputService:GetMouseLocation() - lastPos
            toggleButton.Position = UDim2.new(toggleButton.Position.X.Scale, toggleButton.Position.X.Offset + delta.X, toggleButton.Position.Y.Scale, toggleButton.Position.Y.Offset + delta.Y)
            lastPos = UserInputService:GetMouseLocation()
        end)
    end
end)
toggleButton.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = false
        RunService:UnbindFromRenderStep("Drag")
    end
end)

print("Autofarm Script Loaded! Click the circle button to open menu.")
